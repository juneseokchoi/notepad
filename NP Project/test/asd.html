<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #notes {
            display: flex;
            flex-wrap: wrap;
        }
        .note {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
            width: 200px;
        }
        .note img {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <h1>Note List</h1>
    <button id="addNote">Add Note</button>
    <div id="notes"></div>

    <script>
        document.getElementById('addNote').addEventListener('click', addNote);

        function addNote() {
            const note = document.createElement('div');
            note.className = 'note';
            note.innerHTML = `
                <textarea placeholder="Write your note here..."></textarea>
                <input type="file" accept="image/*" onchange="loadImage(event)">
                <button onclick="saveNote()">Save</button>
                <button onclick="deleteNote()">Delete</button>
            `;
            document.getElementById('notes').appendChild(note);
        }

        function loadImage(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                event.target.parentElement.appendChild(img);
            }
            reader.readAsDataURL(file);
        }

        function saveNote() {
            const note = event.target.parentElement;
            const content = note.querySelector('textarea').value;
            const fileName = new Date().getTime(); // 현재 시간을 파일 이름으로 사용
            const noteData = {
                fileName: fileName.toString(),
                content: content
            };

            fetch('/notes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(noteData)
            }).then(response => {
                if (response.ok) {
                    alert('Note saved successfully');
                } else {
                    alert('Error saving note');
                }
            });
        }

        function deleteNote() {
            const note = event.target.parentElement;
            const fileName = note.querySelector('h2').textContent;

            fetch(`/notes/${fileName}`, {
                method: 'DELETE'
            }).then(response => {
                if (response.ok) {
                    note.remove();
                    alert('Note deleted successfully');
                } else {
                    alert('Error deleting note');
                }
            });
        }

        window.onload = function() {
            fetch('/notes')
                .then(response => response.json())
                .then(notes => {
                    const container = document.getElementById('notes');
                    notes.forEach(noteData => {
                        const note = document.createElement('div');
                        note.className = 'note';
                        note.innerHTML = `
                            <h2>${noteData.fileName}</h2>
                            <textarea>${noteData.content}</textarea>
                            <button onclick="saveNote()">Save</button>
                            <button onclick="deleteNote()">Delete</button>
                        `;
                        container.appendChild(note);
                    });
                });
        }
    </script>
</body>
</html>
